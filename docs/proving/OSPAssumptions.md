# One Step Proof Assumptions

Not all instruction executions can be proven.
This documents a list of assumptions made about what's being executed.

## The WAVM code is generated by Arbitrator from valid WASM

WAVM is the name of the custom instruction set similiar to WASM used for proving.
Arbitrator transpiles WASM code into WAVM.
It also invokes wasm-validate from [wabt](https://github.com/WebAssembly/wabt)
(the WebAssembly Binary Toolkit) to ensure the input WASM is valid.
WAVM produced otherwise may not be executable, as it may try to close a non-existent block,
mismatch types, or do any other number of invalid things which are prevented by WASM validation.

## Inbox messages must not be too large

The current method of inbox hashing requires the full inbox message be available for proving.
That message must not be too large as to prevent it from being supplied for proving,
which is enforced by the inboxes.

A reasonable length limit is 117,964 bytes, which is 90% of the
[max transaction size Geth will accept](https://github.com/ethereum/go-ethereum/blob/356bbe343a30789e77bb38f25983c8f2f2bfbb47/core/tx_pool.go#L53),
leaving 13,107 bytes for other proving data.

## Requested preimages must be known and not too large

WAVM has an opcode which resolves the preimage of a Keccak-256 hash.
This can only be executed if the preimage is already known,
and can only be proven if the preimage isn't too long.
A reasonable length limit is 117,964 bytes for the reasons mentioned above.
Here's a list of which preimages may be requested by Nitro, and why they're safe to request:

### Block headers

Nitro may request up to the last 256 block headers.
The last block header is required to determine the current state,
and blocks before it are required to implement the `BLOCKHASH` evm instruction.

This is safe as block headers are a fixed size, and are known to all nodes.

### State trie access

To resolve state, Nitro traverses the state trie by resolving preimages.

This is safe as validators retain archive state of unconfirmed blocks,
each trie branch is of a fixed size,
and the only variable sized entry in the trie is contract code,
which is limited by EIP-170 to about 24KB.
